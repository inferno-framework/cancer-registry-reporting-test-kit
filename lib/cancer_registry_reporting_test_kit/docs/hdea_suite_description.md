## Overview
The Cancer Registry Reporting HDEA Report Creation Test Suite verifies the
conformance of systems to the report generation requirements for Health Data Exchange Apps (HDEAs)
in the STU 1.0.0 version of the HL7® FHIR® 
[Central Cancer Registry Reporting IG](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/).

## Scope

This test suite focuses on the report creation portion of the HDEA's role in submitting reports to central cancer
registries. Specifically, these test verify that the HDEA can generate a set of conformant and complete 
[Central Cancer Registry Reporting Content Bundles](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-content-bundle.html).

Other aspects of the HDEAs role as defined
in the IG are currently out of scope for this suite, including:
- The use of FHIR APIs to gather instances from an EHR and the use of FHIR Subscriptions to receive notifications from the EHR.
- The use of FHIR APIs to transfer reports to an intermediary or cancer registry using the MedMorph framework.
- The use of MedMorph Knowledge Artifacts.

## Test Methodology

To verify that the system under test can produce conformant and complete cancer reports, Inferno asks
the tester to provide as input a set of [Central Cancer Registry Reporting Content Bundles](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-content-bundle.html)
generated from the system under test. Inferno will check that each Bundle in the input contains a
[Central Cancer Registry Report Composition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-composition.html)
and that referenced instances are conformant to the profiles required by
the Composition profile. Additionally, to verify completeness the tests check for a populated example of each
must support element designated in the Bundle and Composition profiles as well as all profiles specified in
must support reference elements on the Composition profile.

## Running the tests 

### Quick Start

The minimal amount of information Inferno needs to run these tests includes the following inputs:
- **Cancer Reports**: A comma-Separated list of one or more FHIR Central Cancer Registry Reporting
  Content Bundles in JSON format generated by the system under test.

Testers will need to generate one or more reports using the system they are testing, paste them into
the input in Inferno and run the tests. Inferno will evaluate the reports and provide test results.

### Demonstration

If you would like to try out the tests using example data from the CCRR IG and referenced IGs, use
the "HDEA Demo Report" preset which was created by starting with the [Central Cancer Registry Reporting Composition - Example](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/Composition-ccrr-composition-example.json.html)
and adding additional sections and references to the Composition as well as adding entries with the referenced instances.
Not all of the tests are expected to pass when run against the demo report.

## Current Limitations

### HDEA Report generation and EHR data access differences

The CCRR IG includes several inconsistencies between its specification of EHR capabilities and HDEA
capabilities, including:
- The EHR Capability Statement points to the [US Core 3.1.1 Server Capability Statement](https://hl7.org/fhir/us/core/STU3.1.1/CapabilityStatement-us-core-server.html),
  while the [CCRR Composition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-content-bundle.html)
  created by the HDEA uses [US Core 5.0.1](https://hl7.org/fhir/us/core/STU5.0.1/)
  profiles, except for Condition which uses the US Core 3.1.1 profile.
- The EHR Capability Statement requires support for US Core APIs on resource types that are not
  required to be in the [CCRR Composition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-content-bundle.html),
  either through a direct reference or through a reference from a must support element, e.g., the
  US Core Immunization profile.
- The [CCRR Composition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-content-bundle.html)
  requires support for profiles that are not supported within the API, such as the Occupational Data for Health (ODH) 
  [Usual Work profile](http://hl7.org/fhir/us/odh/STU1.1/StructureDefinition-odh-UsualWork.html)
  and the [Central Cancer Registry Reporting Primary Cancer Condition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-central-cancer-registry-primary-cancer-condition.html).

It is also worth noting that the [Central Cancer Registry Reporting Primary Cancer Condition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-central-cancer-registry-primary-cancer-condition.html) leverages the [Cancer Disease Status Evidence Type Extension](http://hl7.org/fhir/us/mcode/STU4/StructureDefinition-mcode-cancer-disease-status-evidence-type.html). This element is marked must support in the profile despite being restricted for use within only Observations (not Condidtions). This means that validation and must support tests for this resource cannot both pass at once.


Currently this HDEA suite and the EHR suite test the requirements indicated in the IG despite the mismatch
and their potential to cause interoperability issues or extra implementation burden. Future versions of
the test kit may update this approach based on community feedback and IG updates.

### Extra Bundle entries

This test suite currently only checks for the presence of instances referenced from the
[CCRR Composition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-content-bundle.html) and their conformance to the required profiles based on their section.
The tests do not check that
- Instances recursively referenced from these instances are also present in the Bundle (a warning is
  logged that lists unresolved references).
- Recursively referenced instances that are present in the Bundle conform to the profile(s) required
  by the referencing element(s).
- All must support elements for recursively referenced profiles are demonstrated.

For example the [US Core Encounter profile](https://hl7.org/fhir/us/core/STU5.0.1/StructureDefinition-us-core-encounter.html)
is referenced from the must support `encounter` element in the [CCRR Composition](https://hl7.org/fhir/us/central-cancer-registry-reporting/STU1/StructureDefinition-ccrr-content-bundle.html)
and the [US Core Encounter profile](https://hl7.org/fhir/us/core/STU5.0.1/StructureDefinition-us-core-encounter.html)
requires support for the [US Core Practitioner profile](https://hl7.org/fhir/us/core/STU5.0.1/StructureDefinition-us-core-practitioner.html)
on the `participant.individual` element. This test suite does not currently test that in a
Bundle where `participant.individual` is demonstrated referencing a Practitioner that the referenced
instance is also present in the Bundle and that it conforms to the [US Core Practitioner profile](https://hl7.org/fhir/us/core/STU5.0.1/StructureDefinition-us-core-practitioner.html). 
Must support elements for the [US Core Practitioner profile](https://hl7.org/fhir/us/core/STU5.0.1/StructureDefinition-us-core-practitioner.html)
also do not need to be demonstrated currently.

The CPDS IG does not explicitly require that the above requirements are met, but some or all of them are likely
to be necessary or helpful in practical applications of report exchange. Future versions
of this test suite may update this approach based on community feedback and IG updates.

### Usual Work MS Slice check by Code System

The [ODH Usual Work](http://hl7.org/fhir/us/odh/STU1.1/StructureDefinition-odh-UsualWork.html) profile includes must support slices which are bound to code systems containing large sets of codes. Given the size of these code systems, the presence of these slices is verified by checking only the code system itself, instead of the code and code system together.

### No API-based Submission

The CCRR IG refers to the MedMorph framework for submission which uses FHIR Messaging. Currently, this test suite
does not support submission of reports using this standards-based approach and instead requires manual provision of
the reports using Inferno inputs. Future versions may include support for FHIR Messaging or other approaches
to submission.